<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<title>MACç®¡ç†æ§åˆ¶å°</title>
	<link rel="stylesheet" href="style.css">
</head>
<body>
	<div class="main-container">
		<nav class="side-nav">
			<a href="index.html" class="nav-item"><span>ğŸ“¦å›ºä»¶æ›´æ–°</span></a>
			<a href="uboot.html" class="nav-item"><span>ğŸš€UBOOTæ›´æ–°</span></a>
			<a href="art.html" class="nav-item"><span>ğŸ“¶ARTæ›´æ–°</span></a>
			<a href="mibib.html" class="nav-item"><span>ğŸ“ŠMIBIBæ›´æ–°</span></a>
			<a href="mac.html" class="nav-item active"><span>ğŸ› ï¸MACç®¡ç†</span></a>
			<a href="env.html" class="nav-item"><span>âš™ï¸å˜é‡ç®¡ç†</span></a>
		</nav>
		<main class="content-area">
			<section class="content-page active" id="page-mac">
				<h1>ğŸ› ï¸MACç®¡ç†</h1>
				<!-- æ·»åŠ  upload-card åŒ…è£¹å±‚ -->
				<div class="upload-card">
					<!-- ç¬¬ä¸€è¡Œï¼šæ ‡ç­¾ -->
					<div class="form-row">
						<div class="form-group">
							<label for="action-type">æ“ä½œç±»å‹</label>
						</div>
						<div class="form-group">
							<label for="interface">ç½‘ç»œæ¥å£</label>
						</div>
						<div class="form-group">
							<label for="mac-address">MACåœ°å€</label>
						</div>
					</div>
					<!-- ç¬¬äºŒè¡Œï¼šè¾“å…¥æ§ä»¶ -->
					<div class="form-row">
						<div class="form-group">
							<select id="action-type" class="form-control">
								<option value="read">è¯»å–MAC</option>
								<option value="write">ä¿®æ”¹MAC</option>
							</select>
						</div>
						<div class="form-group">
							<select id="interface" class="form-control">
								<option value="eth0">eth0</option>
								<option value="eth1">eth1</option>
								<option value="wifi0">wifi0</option>
								<option value="wifi1">wifi1</option>
								<option value="wifi2">wifi2</option>
							</select>
						</div>
						<div class="form-group">
							<input type="text" id="mac-address" class="form-control" 
								placeholder="æ ¼å¼: aa:bb:cc:dd:ee:ff æˆ– aa-bb-cc-dd-ee-ff æˆ– aabbccddeeff">
						</div>
					</div>
					<button class="submit-btn" id="mac-submit" type="button">æ‰§è¡Œæ“ä½œ</button>
				</div>
				<div class="result-box" id="mac-result">
					<div class="result-content"></div>
				</div>
				<div class="notice-box">
					<div class="notice-text">
						<p>â€¢ MACåœ°å€æ ¼å¼æ”¯æŒ12ä½è¿ç»­å­—ç¬¦(ä¾‹å¦‚a0b1c2d3e4f5æˆ–a0:b1:c2:d3:e4:f5æˆ–a0-b1-c2-d3-e4-f5);</p>
						<p>â€¢ ä¿®æ”¹æ— çº¿MACåœ°å€ä¼šè‡ªåŠ¨æ ¡éªŒå¹¶æ›´æ–°æ ¡éªŒå’Œæ•°å€¼ï¼›</p>
						<p>â€¢ è‹¥æ“ä½œåæ— çº¿é€Ÿç‡å¼‚å¸¸ï¼Œè¯·é‡åˆ·åŸå‚ARTå¹¶é‡æ–°è®¾ç½®MACåœ°å€ï¼Œæˆ–è€…ä¿æŒåŸå‚é»˜è®¤MACåœ°å€ã€‚</p>
					</div>
				</div>
			</section>
		</main>
	</div>
	<script>
document.addEventListener('DOMContentLoaded', () => {
	const dom = {
		actionType: document.getElementById('action-type'),
		macSubmit: document.getElementById('mac-submit'),
		resultBox: document.getElementById('mac-result'),
		macAddress: document.getElementById('mac-address'),
		iface: document.getElementById('interface')
	};
	// ä¿è¯ result-content å§‹ç»ˆå­˜åœ¨
	function getResultContent() {
		let result = dom.resultBox.querySelector('.result-content');
		if (!result) {
			result = document.createElement('div');
			result.className = 'result-content';
			dom.resultBox.innerHTML = '';
			dom.resultBox.appendChild(result);
		}
		return result;
	}
	// è‡ªåŠ¨æ ¼å¼åŒ–MACåœ°å€è¾“å…¥
	dom.macAddress.addEventListener('input', function(e) {
		let value = e.target.value.replace(/[^a-fA-F0-9: -]/g, '');
		let cursorPos = e.target.selectionStart;
		// ç§»é™¤æ‰€æœ‰éå­—æ¯æ•°å­—å­—ç¬¦
		let cleanValue = value.replace(/[^a-fA-F0-9]/g, '');
		// å¦‚æœé•¿åº¦è¶…è¿‡12ï¼Œæˆªæ–­
		if (cleanValue.length > 12) {
			cleanValue = cleanValue.substring(0, 12);
		}
		// è‡ªåŠ¨æ·»åŠ åˆ†éš”ç¬¦ï¼ˆç”¨æˆ·è¾“å…¥ç¬¬2ã€4ã€6ã€8ã€10ä¸ªå­—ç¬¦æ—¶ï¼‰
		let formattedValue = '';
		for (let i = 0; i < cleanValue.length; i++) {
			if (i > 0 && (i % 2 === 0) && i < 10) {
				// æ£€æµ‹ç”¨æˆ·æ˜¯å¦è¾“å…¥äº†åˆ†éš”ç¬¦
				if (value.length > cursorPos - 1 && (value[cursorPos - 1] === ':' || value[cursorPos - 1] === '-')) {
					formattedValue += value[cursorPos - 1]; // ä¿ç•™ç”¨æˆ·è¾“å…¥çš„åˆ†éš”ç¬¦
				} else {
					formattedValue += ':'; // é»˜è®¤ä½¿ç”¨å†’å·
				}
			}
			formattedValue += cleanValue[i];
		}
		e.target.value = formattedValue.toLowerCase();
		// æ¢å¤å…‰æ ‡ä½ç½®
		let newCursorPos = cursorPos;
		if (formattedValue.length > value.length) {
			newCursorPos += formattedValue.length - value.length;
		}
		e.target.setSelectionRange(newCursorPos, newCursorPos);
	});
	dom.macSubmit.addEventListener('click', () => {
		const result = getResultContent();
		dom.resultBox.className = '';
		result.className = 'result-content';
		result.innerHTML = '';
		const action = dom.actionType.value;
		const iface = dom.iface.value;
		let mac = dom.macAddress.value.trim();
		// æ¸…ç†MACåœ°å€æ ¼å¼ï¼ˆç§»é™¤æ‰€æœ‰éå­—æ¯æ•°å­—å­—ç¬¦ï¼‰
		mac = mac.replace(/[^a-fA-F0-9]/g, '');
		if (action === 'write' && mac.length !== 12) {
			dom.resultBox.className = 'error';
			result.innerHTML = '<div style="text-align: center">é”™è¯¯ï¼šMACåœ°å€æ ¼å¼æ— æ•ˆ</div>';
			return;
		}
		dom.resultBox.className = '';
		result.innerHTML = 'å¤„ç†ä¸­...';
		let params = 'action=' + encodeURIComponent(action) + '&iface=' + encodeURIComponent(iface);
		if (action === 'write') params += '&mac=' + encodeURIComponent(mac);
		fetch('/macrw', {
			method: 'POST',
			headers: {'Content-Type': 'application/x-www-form-urlencoded'},
			body: params
		}).then(resp => resp.text())
		.then(txt => {
			if (txt.indexOf('æˆåŠŸ') !== -1 || txt.indexOf('success') !== -1) {
				dom.resultBox.className = 'success';
				result.innerHTML = '<div style="text-align:center">' + txt + '</div>';

				// è‹¥ä¸ºè¯»å–æ“ä½œï¼Œè‡ªåŠ¨å¡«å……MACåœ°å€ï¼ˆå¸¦å†’å·åˆ†éš”ç¬¦ï¼‰
				if (action === 'read') {
					const match = txt.match(/([0-9a-fA-F]{2}):([0-9a-fA-F]{2}):([0-9a-fA-F]{2}):([0-9a-fA-F]{2}):([0-9a-fA-F]{2}):([0-9a-fA-F]{2})/i);
					if (match) {
						dom.macAddress.value = match[0].toLowerCase();
					}
				}
			} else {
				dom.resultBox.className = 'error';
				result.innerHTML = '<div style="text-align:center">' + txt + '</div>';
			}
		}).catch(() => {
			dom.resultBox.className = 'error';
			result.innerHTML = '<div style="text-align: center">è¯·æ±‚å¤±è´¥</div>';
		});
	});
});
	</script>
</body>
</html>