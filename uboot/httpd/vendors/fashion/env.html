<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<title>ç¯å¢ƒå˜é‡è®¾ç½®</title>
	<link rel="stylesheet" href="style.css">
</head>
<body>
	<div class="main-container">
		<nav class="side-nav">
			<a href="index.html" class="nav-item"><span>ğŸ“¦å›ºä»¶æ›´æ–°</span></a>
			<a href="uboot.html" class="nav-item"><span>ğŸš€UBOOTæ›´æ–°</span></a>
			<a href="art.html" class="nav-item"><span>ğŸ“¶ARTæ›´æ–°</span></a>
			<a href="mibib.html" class="nav-item"><span>ğŸ“ŠMIBIBæ›´æ–°</span></a>
			<a href="mac.html" class="nav-item"><span>ğŸ› ï¸MACç®¡ç†</span></a>
			<a href="env.html" class="nav-item active"><span>âš™ï¸ç¯å¢ƒå˜é‡â—€</span></a>
		</nav>
		<main class="content-area">
			<section class="content-page active" id="page-env">
				<h1>âš™ï¸ç¯å¢ƒå˜é‡è®¾ç½®</h1>
				<div class="upload-card">
					<form id="env-form" autocomplete="off">
						<div class="form-group">
							<label for="env-var">å˜é‡å(ä¾‹å¦‚ï¼šbootcmd/ipaddr/serverip/single_part/all)</label>
							<input type="text" id="env-var" class="form-control" required>
						</div>
						<div class="form-group">
							<label for="env-val">å˜é‡å€¼ï¼ˆç•™ç©ºä»…æŸ¥è¯¢ï¼‰</label>
							<input type="text" id="env-val" class="form-control">
						</div>
						<div class="env-button-group">
							<button type="button" class="submit-btn" id="query-btn">æŸ¥è¯¢å˜é‡</button>
							<button type="button" class="submit-btn" id="modify-btn">ä¿®æ”¹å˜é‡</button>
							<button type="button" class="submit-btn delete-btn" id="delete-btn">åˆ é™¤å˜é‡</button>
							<button type="button" class="submit-btn reboot-btn" id="reboot-btn">é‡å¯è®¾å¤‡</button>
						</div>
					</form>
				</div>
				<div class="notice-box" id="env-result"></div>
			</section>
		</main>
	</div>
	<script>
	document.getElementById('env-form').onsubmit = function(e){
		e.preventDefault();
		var v = document.getElementById('env-var').value.trim();
		var val = document.getElementById('env-val').value.trim();
		var result = document.getElementById('env-result');
		if (!v) {
			result.textContent = 'è¯·è¾“å…¥å˜é‡å';
			result.className = 'notice-box danger';
			return;
		}
		result.textContent = 'å¤„ç†ä¸­...';
		result.className = 'notice-box';
		var body = 'var=' + encodeURIComponent(v);
		if (val) body += '&val=' + encodeURIComponent(val);
		fetch('/setenv', {
			method: 'POST',
			headers: {'Content-Type': 'application/x-www-form-urlencoded'},
			body: body
		}).then(r=>r.text()).then(t=>{
			result.textContent = t;
			if(t.indexOf('Success')!==-1 || t.indexOf('Value:')!==-1) {
				result.className = 'notice-box success';
				// æŸ¥è¯¢åˆ°å€¼æ—¶è‡ªåŠ¨å¡«å……åˆ°è¾“å…¥æ¡†
				var m = t.match(/Value:\s*\S+=(.*)/);
				if(m) document.getElementById('env-val').value = m[1];
			} else {
				result.className = 'notice-box danger';
			}
		});
	};

	// é‡å¯æŒ‰é’®JS
	document.getElementById('reboot-btn').onclick = function(){
		if(confirm('ç¡®å®šè¦é‡å¯è®¾å¤‡å—ï¼Ÿ')) {
			fetch('/reset', {method:'POST'})
			.then(r=>r.text())
			.then(t=>{
				alert('è®¾å¤‡æ­£åœ¨é‡å¯ï¼\n' + t);
			});
		}
	};

	// æ·»åŠ åˆ é™¤æŒ‰é’®äº‹ä»¶å¤„ç†
	document.getElementById('delete-btn').onclick = function() {
	    var varName = document.getElementById('env-var').value.trim();
	    var result = document.getElementById('env-result');
	    
	    if (!varName) {
	        result.textContent = 'è¯·è¾“å…¥è¦åˆ é™¤çš„å˜é‡å';
	        result.className = 'notice-box danger';
	        return;
	    }
	    
	    if (confirm('ç¡®å®šè¦åˆ é™¤å˜é‡ "' + varName + '" å—ï¼Ÿ')) {
	        result.textContent = 'æ­£åœ¨åˆ é™¤...';
	        result.className = 'notice-box';
	        
	        fetch('/setenv', {
	            method: 'POST',
	            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
	            body: 'var=' + encodeURIComponent(varName) + '&val='
	        }).then(r => r.text()).then(t => {
	            result.textContent = t;
	            result.className = t.includes('Success') ? 'notice-box success' : 'notice-box danger';
	        });
	    }
	};
	
	// æŸ¥è¯¢æŒ‰é’®äº‹ä»¶
	document.getElementById('query-btn').onclick = function() {
	    var varName = document.getElementById('env-var').value.trim();
	    var result = document.getElementById('env-result');
	    
	    if (!varName) {
	        result.textContent = 'è¯·è¾“å…¥å˜é‡å';
	        result.className = 'notice-box danger';
	        return;
	    }
	    
	    fetch('/setenv', {
	        method: 'POST',
	        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
	        body: 'var=' + encodeURIComponent(varName)
	    }).then(r => r.text()).then(t => {
	        // æ›¿æ¢æ¢è¡Œç¬¦ä¸ºHTMLæ¢è¡Œæ ‡ç­¾
	        result.innerHTML = t.replace(/\n/g, '<br>');  // ä½¿ç”¨innerHTMLè€Œä¸æ˜¯textContent
	        if(t.indexOf('Success')!==-1 || t.indexOf('Value:')!==-1) {
	            result.className = 'notice-box success';
	            // æŸ¥è¯¢åˆ°å€¼æ—¶è‡ªåŠ¨å¡«å……åˆ°è¾“å…¥æ¡†
	            var m = t.match(/Value:\s*\S+=(.*)/);
	            if(m) document.getElementById('env-val').value = m[1];
	        } else {
	            result.className = 'notice-box danger';
	        }
	    });
	};
	
	// ä¿®æ”¹æŒ‰é’®äº‹ä»¶
	document.getElementById('modify-btn').onclick = function() {
	    var varName = document.getElementById('env-var').value.trim();
	    var varValue = document.getElementById('env-val').value.trim();
	    var result = document.getElementById('env-result');
	    
	    if (!varName || !varValue) {
	        result.textContent = 'è¯·è¾“å…¥å˜é‡åå’Œå˜é‡å€¼';
	        result.className = 'notice-box danger';
	        return;
	    }
	    
	    fetch('/setenv', {
	        method: 'POST',
	        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
	        body: 'var=' + encodeURIComponent(varName) + '&val=' + encodeURIComponent(varValue)
	    }).then(r => r.text()).then(t => {
	        result.textContent = t;
	        result.className = t.includes('Success') ? 'notice-box success' : 'notice-box danger';
	    });
	};
	</script>
</body>
</html>
